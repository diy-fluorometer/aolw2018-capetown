# Plan for the day

* Assemble the case
* Take photos of the assembly process
* Write assembly instructions
* First test measurements with text marker (dilution series)
* Pulsing LED from NodeMCU?
* If there is time: cut the glass filters

# What we did today

## Case assembly

The case assembly is done. We also did a photo series of all assembly steps to include in the assembly instructions. The photos still have to be edited; the raw versions are in this repo in `$REPOROOT/docs/assembly/unedited`.

## Test measurements

We did not get around to doing test measurements yet - there were some changes that needed to be made to the NodeMCU software first.

## Pulsing LED / Cellphone-only approach

In order to power a LED with your phone you need to turn the usb plug of the phone into a "master" that supplies the connected device with the 5 V that usb devices run on. to do that you basically have to buy or build an usb on the go (otg) cable. there are a lot of instructables (http://www.instructables.com/howto/usb+otg+cable/)
The trick is that the micro usb in your phone has 5 pins while a standard usb has 4. 
to turn the micro usb into a "master" you have to short circiut pin 4 and pin 5 as seen in this figure.
![alt text](https://cdn.instructables.com/FTN/IHEZ/HSRZGLMJ/FTNIHEZHSRZGLMJ.LARGE.jpg "difference between normal usb and usb otg cable")

In our case its enough to get out + and GND and i devised a simpler version where just those pins have cables and pin 4 and 5 are soldered together. As seen here.

![alt text](https://lh3.googleusercontent.com/O_WhK3-zuIbS__mPMCs2SaMPNOC7888yp4b2asA19UrpN9ar5wADINT8f0rxp_4I0DLL9sD5XhIgaIXnCsTouX_gh0NYqCYHTwMYusTtVb09T9i4d3MZ7WpifxC7X3mwrXv5feS4ykQKqJ2wVFYsc3R2vA8YB59YQCOZT7wjdqKqzzdYF_pqGs8X-OzplDLM0ExsCmDSClv0N3cgZUy3kMZj_sVZlXyvPgeD3qVRm2fllUKrzM1oeiQXiPKy1UvNWL034279xrTbkbaGYreWx8_uLBI4Zs8I6XLP38qiNWhoa1HMNjoqAN5oo2DE5JKQ32umuvNPIB6bS-NpaaA4oUj_O5MMwm9URMgkPnkgqOLwNyBTCG8YRJcMjCQDIyNCU_F0mJBChIn-ds4FuBlQ6M3u96loRCwujwcriDDngJCNrN8XSAgxVHVIR3rQ2pVbP99f-XJl5lKt3aiU6tRPR1tKLwU_UP8-cSYROcTcorZlrFpVN4yfFwCOpdXRW6ciaYoLeB-pkw2TMS9LJiZRu3dE0T9rYRz0EvtlsZ53qXlkya326diMTqT_glFUlkZGaB92M2FOhA6SsvwD7h1oXsdaoBMkLIBP6z4qMFkKkfhkcrJq8zAYTSIt7sHDXO5tjSe0IRCNE6vg-SGuYvPCtz6BFNvJIGzkKw=w704-h938-no "usb otg cable for powering an LED")

in order to make the LED light measurable with the sound input of the phone the LED has to be pulsed with a frquency between 20 and 20kHz. To switch the LED with a desired frequency i initially wanted to use a transistor that is switched with the sound output. I currently have no transistor that is saturated at 0.5 V and i need an op amp or a low voltage switching transistor. 
To circumvent this problem for now i devised the following circiut.


![alt text](https://lh3.googleusercontent.com/gf1V-JmxJwxa6gSVRnNkjyXgWllWBm3fa_odYMT2nHaI7yzq6ZXvrhHVpABdSmu7qrfEcaeZuBKYoL5fhcJkoFE3MLFzyf1CUggPH7Xs3EJM9RFkogvWAgNFiyeFITrkENkhQnCSoRdnJ30EJni7AN0tYz1sEAQ00otdl1VShxMNH4NiYfmCeX8-LOX5uDfuHkpPBEdcStQMdKQUF7DUNQXa-Fh_AvsJPkSqkxxYNHNpkXhLPU2irvAgH-gIlPg69RdFR3pvZLEXYpc2tZBnEmZia_HrGrukyGwhnutNHKqfGCrZrTjy7yQD2chCGRv9vP_U5GwztDhC-8GFmoO-ypiacuQODHZ0e0bMiBtwUwRfByseGjX_LhqcZ2xB1nGXG8_UZHH3rrxen4fcmAnstyV6fsjAH1rdCfhoZiGS_Hhk3rKvAQ_3cEcon0gB-ShSwfGqVx0W3-_GWDN1F1wQpxzeBkwjyn7GIjoxAPh2hZDAAuoE8YzKLw-I4Z2WFUO1-mrQb0BPdE-elr-7t8Gizbliji-VSH-iSRzJ7xRjX8YU6Vuev70RDMgLwUFpwdsrvdI1n7RklPWdLn6ci7YCSNpHxIzidDSXJBR5QbM5=w360-h233-no "pinout for android headphone jack")

This circiut makes it possible to modulate the light emmited by the LED. 

the circuit is a good example of bad engeneering and at this point i would not recomend replicating it. It runs current through the audio output. in the case of my phone it does not appear to destroy the phone immediately but i cant't promise this to be the case for other phones. However in this video shows that it works (https://photos.app.goo.gl/Z7diii5wAZOSIRTq1). The LED "flikers" really fast and the photoresistor picks up the signal which can in turn be measured with the spectrum analyser (audio) function of the physics toolbox app
(https://play.google.com/store/apps/details?id=com.chrystianvieyra.physicstoolboxsuite&hl=en_US).




![alt text](https://source.android.com/devices/accessories/headset/images/headset-circuit2.png "pinout for android headphone jack")

## Cutting glass filters

We also did not get around to that today.

## Changes to NodeMCU software

Lisa started to re-work the NodeMCU code; the code is starting to out-grow the basic Arduino sketch scope, so the re-work is mostly about modularizing it to make maintenance and collaboration easier.

* Introduce some data structures
* Pull out the HTML/UI code from the C code
* Define HTTP endpoints more cleanly
* Encapsulate and re-organize the measuring and storing of measurements

