---
title: "AOLW2018, 16.04.2018 - 28.04.2018, Capetown, South Africa - Final report"
author: "Lisa Thalheim, Robert Richter, Alessandro Volpato"
date: "April 27, 2018"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(ggplot2)
```

## Abstract

Fluorometric DNA quantification is an established laboratory procedure for which commercial products are available. The simplicity of the method lends itself well to an Open Hardware and DIY approach, which permits practitioners to build a simple low-cost device that gives sufficiently accurate measurements for at least some applications.
During the Advanced Open Labware Workshop in Capetown, South Africa, we worked on building and characterizing such a device. All work at the workshop was done with the goal of eventually being able to release a bundle of CAD files, code, assembly instructions, and documentation for this OpenFluorometer.

## Introduction

Fluorometric quantification of DNA is an established method of quality control when working with DNA samples, particularly for downstream work such as PCR and DNA sequencing. Quality control of DNA samples serves several purposes for these methods: 1) to establish a baseline for reproducibility, 2) to troubleshoot experiments, and 3) to catch poor starting conditions early, before wasting costly reagents and consumables. This quality control of DNA samples usually consists of two complementary steps: 1) Estimation of the purity of the sample, which is done using UV spectrophotometry, and 2) DNA quantification using fluorescent dyes. This work focuses on the latter.

Fluorometers are commercially available for around $4000 when bought new. This is a substantial amount of money for labs with limited funds, such as labs in Low and Middle Income Countries (LMIC) as well as citizen science labs. Since the working principle of fluorometers is relatively simple, we set out to build a DIY version and evaluate its performance in relation to a) commercial systems and b) lab procedures that were of particular importance to us (namely DNA sequencing with an Oxford Nanopore MinION). Our main motivating question was: Can we build a fluorometer from relatively cheap parts that performs well enough for our purposes?

## Previous work

A first proof-of-principle fluorometer was built at the Science Hack Day Berlin in November 2017. It did not yet produce results that would be useful for quality control of DNA samples, but we did manage to get measurements that allowed us to distinguish between different dilutions of a DNA ladder with a starting concentration of 200ug/ml. This first prototype used an Adafruit TSL2591 light sensor, a blue LED, a 510nm long-pass acrylic filter, an Arduino and a 10ul pipette tip as a sample vessel.

A second prototype was built in December 2017 which aimed to improve on the proof-of-principle device. It used a hand-made "cuvette" that consisted of two pieces cut from 3mm and 8mm clear acrylic that were then glued together. The volume of this cuvette was 45ul. The same sensor, microcontroller platform and LED were used, but a plastic lens with a diameter of 10mm and an FL of 10.3mm was added to focus the fluorescent light on the sensor. The results were a lot more encouraging for this version. The linear range of the system was not well established, but the lower detection limit was determined to be around 10ug/ml.

Some problems and open questions remained with this second prototype. We were not convinced that the hand-made cuvette was a good approach - the laser melted the acrylic in non-reproducible ways that left clearly visible streaks and distortions on the surface of the material. The process of glueing the two parts together was also tedious and imprecise and not conducive to reproducibility.
The 510nm long-pass filter was also chosen for easy availability rather than suitability, so we wanted to try some more deliberately selected filters to see whether this would yield improvements. The fluorescent dye used in all experiments so far was GelGreen, which is not as well established as other dyes such as SYBR Green I and PicoGreen. Again, this dye was chosen because it was easily available to us, not because it was known to be a good dye to use. On the contrary: There are protocols and publications on DNA quantification with SYBR Green I and PicoGreen, but none that use GelGreen.
Another open question was how the device would behave when measuring a sample from an actual DNA extraction; so far, only DNA ladders without loading dye were used as samples. It is possible that samples from DNA extraction behave quite different than DNA ladders, which are presumably fairly pure.

## Objectives for the Advanced Open Labware Workshop

The main objective for the workshop was to try some of the ideas for improvements that came out of the previous designs. The main one was to use standard 0.2ml PCR tubes instead of fabbed cuvettes, since they are widely available and thus do not require a manufacturing step.
We also wanted to move from the Arduino platform to a NodeMCU platform, which is cheaper and also includes WiFi. This would enable us to build a device that can be controlled from a tablet, mobile phone or a computer that is placed out of the way, instead of always having to connect the fluorometer to a computer, which can be impractical in an actual wetlab setting. To take advantage of this change, we planned on modifying the user interface of the device.

Additionally, one of the team members wanted to try a different approach that would dispense with the need for a dedicated microprocessor platform altogether and work only from a smartphone, using a photoresistor, a filter and a blue LED.

The following was our task list at the start of the workshop:

1. Create a modified design of the device for use with standard 0.2ml PCR tubes instead of the hand-made cuvettes, and then produce a device according to this design. The LED, light sensor (TSL2591) and filter (510nm long-pass acrylic) would be the same as in the previous versions.
2. Move the existing control code to the NodeMCU platform.
3. Change the user interface of the device, from text commands on the serial port to a browser-based interface.
4. Evaluate different optical filters, lenses, and fluorescent dyes.
5. Assemble a proof-of-principle for the smartphone-only approach and evaluate it.
6. Do an actual DNA extraction and take measurement from this sample; previously, only DNA ladders were used as samples, which may behave very differently than samples from DNA extractions.

We wanted to answer the following questions:

1. Is the performance of our design centered around 0.2ml PCR tubes as good as or better than the one centered around the hand-made cuvettes?
2. Is the NodeMCU controller capable of handling both measurements and a WiFi-based user interface side-by-side without too much interference between them?
3. Does the performance of the device improve significantly when using other, more delibaretly selected (and more expensive) filters? Or is the previously used cheap acrylic filter good enough?
4. Among the dyes that we have available, is there one that performs particularly well in our device? Is there one that performs particularly poorly? How big are the differences? Are they big enough to justify using a more expensive dye?
5. Does the smartphone-based idea work at all? Is it sensitive enough to quantitatively distinguish between different DNA concentrations? How does its performance compare to the MCU-based version?

## Work done at the Advanced Open Labware Workshop

### Device v3 to accomodate standard 0.2ml PCR tubes

We designed and built another version of the device. On the outside, it looks identical to the previous v2. Both designs consist of an outer box to block out ambient light and an inner sampling assembly. On the inside, we made some changes:

* The sample will be contained in a 0.2ml PCR tube with a target sample volume of 50ul. The sensor, filter and LED were aligned to be on the same plane as the mid-point of those 50ul.
* In v2, the sample was illuminated from below. Since the PCR tubes have a conical shape (as opposed to the flat base of the cuvette used in v2), we thought it better to illuminate the sample from the side and place the sensor at a 90 degree angle to the LED. The LED does not protrude into measuring chamber so that it does not shine directly on the sensor. Instead, it is very nearly flush with the material.
* We did not use a lens in the v3 design. Instead, we moved the sensor as close as possible to where the PCR tube sits. Our reasoning was that the lens was necessary in the v2 design since the sensor was approximately 5cm away from the sample, but it might not be necessary when placing the sensor very close to the sample (~5mm).

We used the same filter as in the v2 design (510nm acrylic long-pass). The circuit we used was the same as in the v2 design, with a NodeMCU switched out for the Arduino:

![Schematic for the TSL2591 version v3](/home/lisa/projects/biolab/hardware/fluorometer/aolw2018-capetown/docs/TSL2591_NodeMCU_schem.png)

### Dilution series with text marker dye

We made a two-fold dilution series using yellow text marker dye. This is a cheap first test to check a new setup, since yellow text marker dye has similar excitation/emission wavelengths to the green fluorescent DNA dyes (GelGreen, SYBR Green I, PicoGreen). It also permits evaluating the linearity of the measurement setup without the additional complexity that stems from the interaction dynamics between dye and DNA. 
The protocol we used is given in Appendix B.

### Dilution series with GelGreen and DNA ladder

We made a two-fold dilution series of DNA ladder (50 bp plus DNA Ladder with no loading dye, BIORON) and ended up with 8 samples with concentrations ranging from 160ug/ml to 1.25ug/ml. We decided to set up the dilution series so that the total amount of dye would be the same in all samples. We briefly discussed setting up a mixture of DNA and dye first and then making a serial dilution from this mixture, but decided against it. This approach would have meant varying both the DNA concentration and the dye concentration in each sample, which would have made the measurements more difficult to interpret. Besides, adding a constant amount of dye more closely mirrors the procedure of actual fluorometric quantification, where the same amount of dye is added to every sample to be measured, and where the calibration using DNA standards of known concentrations is done with reference to a certain fixed amount of dye added.
So we set up the dilution series first to a volume of 40ul and then added 10ul of the same diluted dye stock to all samples. We only tested with one dye concentration so far, a 1:99 dilution of GelGreen 10,000X. Since there are no protocols available for performing DNA quantifications with GelGreen, we estimated the concentration based on the manufacturer's protocol for post-staining gels.
The protocol we used to set up the serial dilution is given in Appendix C.

### Measurements with GelGreen and extracted DNA 

We collected material using cheek swabs from Robert and extracted DNA from this material using QuickExtract DNA extraction solution. We chose this route because the extraction protocol is very simple, fast and convenient and does not require any lab equipment beyond two hot water baths at 65C and 98C. The protocol we followed is given in Appendix A.
We then mixed 40ul of the DNA sample with 10ul of our GelGreen dye stock (1ul GelGreen 10,000X in 99ul of bottled water) and took readings in our fluorometer.
We did a second DNA extraction using QuickExtract where we aimed to increase DNA yield, following the manufacturer's
recommendations to use four swabs instead of one. Again, we mixed 40ul of sample from this second extraction with 10ul of our GelGreen dye stock.

### Cutting glass filters

The two glass filters (495nm dichroic short-pass and 515nm colour glass long-pass) were delivered to us as squares of 5cm by 5cm. Since these dimensions were too large for our device, and also because we were hoping to get several useable filters out of these squares, we had brought along a glass cutter and a small mount made of plastic to keep the filters in place while cutting them. We cut the filters into smaller pieces that would fit into our device. We did get some useable pieces out of this and still have parts of the filters left, but the results were not good. The glass splintered in unintended ways and gave us irregularly shaped As it turns out, cutting small pieces of glass into even smaller pieces takes more practice than we had.

### Measurements with different filters

All initial measurements were done with the 510nm acrylic long-pass filter placed between the sample and the sensor. We then changed the setup and used the 515nm colour glass long-pass filter placed between the sample and the sensor, and the 495nm dichroic glass short-pass filter placed between the LED and the sample. We then measured the serial dilution of DNA ladder plus GelGreen with these filters in place. We also measured the two DNA extraction samples with this new filter setup.

### Assembly and testing of smartphone-only version

Robert proposed building another version that would be centered around an OTG-capable smartphone and a photoresistor.
His basic idea was to supply baseline power of 3V to an LED from the smartphone and modify a pair of headphones with built-in microphone. One of the two audio output wires would be connected to the LED so that any sound played from the smartphone would become an additional voltage input for the LED. The LED thus gets an input voltage between 2.5V and 3.5V depending on the audio signal played from the smartphone. The photoresistor would be connected to the microphone wire; any changes in light would thus become an "audio" input signal to the smartphone. Due to the strongly nonlinear behaviour of the LED the light is very well modulated and can be measured with the photoresistor soldered to the microphone. See schematic below.

![Schematic for the smartphone/photoresistor version](/home/lisa/projects/biolab/hardware/fluorometer/aolw2018-capetown/sketches/IMG-20180513-WA0001.jpg)

We used the same case for this smartphone-version except that the sensor mount was modified to accomodate a photoresistor rather than the TSL2591 lux sensor.

## Results and lessons learned

### Buffer

All protocols that we found for DNA quantification using the fluorescent dyes PicoGreen and SYBR Green I use TE buffer to dissolve DNA and/or to dilute the dye. Alessandro also found a paper quantifying the reason for using buffer instead of distilled water [Nakayama et al 2016]. Briefly, for some types of DNA samples, diluting with distilled water will lead to underestimation of the DNA concentration. The authors speculate that this may be due to conformational changes in the DNA caused by low-salt conditions that reduce affinity for the fluorescent dye.
Before this background, we would need a good reason and a good argument to keep using distilled water, and generally to diverge from established and widely-used protocols, which we don't have, so we resolved to hold off on most of the measurements until we are back in Berlin and get ahold of some TE buffer.
It would be interesting to do measurements with distilled water and added NaCl instead of TE, since the former is probably easier to come by in a remote setting or a setting with limited resources.

### Bug in Arduino code

I discovered a bug in my Arduino code, specifically in how I handled the different gain levels. My approach to translating all levels to a single scale was plain wrong. This means that data from the previous version is not directly comparable to the data from the workshop version, except for the readings at very low light levels (where the values come from sensor readings at gain level MAX). So we need to proceed with caution when comparing the two systems, or just generate new data altogether.

To work around this bug until I can implement and test a better solution, I recorded the sensor readings at all gain levels for each sample. So a measurement right now consists of four tuples (gainlevel,value).

### The lower detection limit of the v3 prototype was around 20ug/ml

A more detailed view of the data we recorded during the workshop can be found in the separate document `analysis/TSL2591_version_evaluation.Rmd` in our GitHub repository (https://github.com/diy-fluorometer/aolw2018-capetown/blob/master/analysis/TSL2591_version_evaluation.Rmd).
The following is an excerpt that shows the results from the serial dilution of DNA ladder with GelGreen.

```{r echo=FALSE}
file <- "../data/2018-04-25_GelGreen_50bpladder_replica2.csv"
dataset <- read.csv(file,
              header = TRUE,
              sep = ",",
              comment.char = "#")

ds_high <- dataset %>% filter(gain == "HIGH")

rects <- data.frame(start=4.5, end=8.5, group=seq_along(start))

ctrl_wd_median <- ds_high %>% filter(name == "ctrl_dye_water") %>% summarise(m = median(value))
cutoff <- data.frame(yintercept=ctrl_wd_median$m, cutoff=factor(ctrl_wd_median$m))
ds_high %>% filter(gain == "HIGH") %>%
  ggplot() + 
  geom_boxplot(mapping = aes(x = name, y = value)) +
  geom_hline(aes(yintercept=yintercept), data=cutoff, colour = "red") +
  scale_x_discrete(limits = c("emptybox", "emptytube", "water", "ctrl_dye_water", "TU1", "TU2", "TU3", "TU4", "TU5", "TU6", "TU7", "TU8"), labels = c("Empty box", "Empty tube", "Water", "Dye+Water", "160 ug/ml", "80 ug/ml", "40 ug/ml", "20 ug/ml", "10 ug/ml", "5 ug/ml", "2.5 ug/ml", "1.25 ug/ml")) +
  labs(y = "Sensor readings", x = "Samples") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  geom_rect(data=rects, inherit.aes=FALSE, aes(xmin=start, xmax=end, ymin=0,
                ymax=max(ds_high$value) + 3000, group=group), color="transparent", fill="orange", alpha=0.3)
```

The sensor readings for the higher concentrations are quite high when compared to the lower concentrations, so let's zoom in on the 20 ug/ml to 1.25 ug/ml range:

```{r echo=FALSE}
ctrl_wd_median <- ds_high %>% filter(name == "ctrl_dye_water") %>% summarise(m = median(value))
cutoff <- data.frame(yintercept=ctrl_wd_median$m, cutoff=factor(ctrl_wd_median$m))
ds_high %>% filter(gain == "HIGH", (name == "ctrl_dye_water" | name == "TU4" | name == "TU5" | name == "TU6" | name == "TU7" | name == "TU8")) %>%
  ggplot() + 
  geom_boxplot(mapping = aes(x = name, y = value)) +
  geom_hline(aes(yintercept=yintercept), data=cutoff, colour = "red") +
  scale_x_discrete(limits = c("ctrl_dye_water","TU4", "TU5", "TU6", "TU7", "TU8"), labels = c("Dye+Water", "20 ug/ml", "10 ug/ml", "5 ug/ml", "2.5 ug/ml", "1.25 ug/ml")) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  labs(y = "Sensor readings", x = "Samples")
```

The horizontal line shows the sensor readings for our water+dye control, which contains no DNA. As can be seen in the plot, we can somewhat distinguish the 20ug/ml sample from the water+dye control, but the 10ug/ml is so close to the water+dye control that we cannot really distinguish the two. It is interesting to note the behaviour of the fluorometer for the samples of even lower concentration, 5ug/ml and below.

### Our DNA extraction did not yield an awesome amount of DNA

```{r echo=FALSE}
file <- "../data/2018-04-26_GelGreen_QE_replica1.csv"
ds1 <- read.csv(file,
              header = TRUE,
              sep = ",",
              comment.char = "#")
file <- "../data/2018-04-26_GelGreen_QE_2_replica1.csv"
ds2 <- read.csv(file,
              header = TRUE,
              sep = ",",
              comment.char = "#")
ds1$experiment <- c("Extraction from one swab")  # QE-1: First DNA extraction w/ 500ul of QE and 1 swab
ds2$experiment <- c("Extraction from four swabs")  # QE-2: Second DNA extraction w/ 300ul of QE and 4 swabs
ds <- rbind(ds1, ds2)
ds_high <- ds %>% filter(gain == "HIGH")
ctrl_wd_median <- ds_high %>% filter(name == "ctrl_dye_qe") %>% summarise(m = median(value))
cutoff <- data.frame(yintercept=ctrl_wd_median$m, cutoff=factor(ctrl_wd_median$m))
ds_high %>% filter(gain == "HIGH") %>%
  ggplot() + 
  geom_boxplot(mapping = aes(x = name, y = value, colour = experiment), na.rm=TRUE) +
  geom_hline(aes(yintercept=yintercept), data=cutoff, colour = "red", size = 0.2) +
  geom_text(aes(0, yintercept, label = "Dye+QE", vjust = 1.5, hjust = -7.5), data = cutoff) +
  scale_x_discrete(limits = c("emptybox", "ctrl_dye_qe", "TU3", "TU4", "MS", "MS2"), labels = c("Empty box", "Dye+QE", "40 ug/ml", "20 ug/ml", "One swab", "Four swabs")) +
  labs(y = "Sensor readings", x = "Samples") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
```

### The smartphone-only version works and gives relative readings somewhat comparable, but not entirely congruent with the TSL2591-centered version.

Generally speaking, the smartphone-only version could in principle distinguish between different concentrations of DNA in the experiments with DNA marker, as apparent from the graph below:

![Measurements with two-fold serial dilution of DNA marker with the smartphone-version](/home/lisa/projects/biolab/hardware/fluorometer/aolw2018-capetown/sketches/chart_dna_cell.png)

The measurements from the two versions were not 100% consistent, though. For example, they contradict each other on the DNA extraction samples. While the TSL2591-version predicts a higher DNA concentration for the MS2 extraction (four swabs) over the MS extraction (one swab), the smartphone-version predicts just the opposite.

![Measurements of extracted DNA with the smartphone-version](/home/lisa/projects/biolab/hardware/fluorometer/aolw2018-capetown/analysis/DNA_cheek_cell__3.png)

```{r echo=FALSE}
file <- "../data/2018-04-26_GelGreen_QE_replica1.csv"
ds1 <- read.csv(file,
              header = TRUE,
              sep = ",",
              comment.char = "#")
file <- "../data/2018-04-26_GelGreen_QE_2_replica1.csv"
ds2 <- read.csv(file,
              header = TRUE,
              sep = ",",
              comment.char = "#")
ds1$experiment <- c("MS")  # QE-1: First DNA extraction w/ 500ul of QE and 1 swab
ds2$experiment <- c("MS2")  # QE-2: Second DNA extraction w/ 300ul of QE and 4 swabs
ds <- rbind(ds1, ds2)
ds_high <- ds %>% filter(gain == "HIGH")
ctrl_wd_median <- ds_high %>% filter(name == "ctrl_dye_qe") %>% summarise(m = median(value))
cutoff <- data.frame(yintercept=ctrl_wd_median$m, cutoff=factor(ctrl_wd_median$m))
ds_high %>% filter(gain == "HIGH") %>%
  ggplot() + 
  geom_boxplot(mapping = aes(x = name, y = value, colour = experiment), na.rm=TRUE) +
  geom_hline(aes(yintercept=yintercept), data=cutoff, colour = "red", size = 0.2) +
  geom_text(aes(0, yintercept, label = "Dye+QE", vjust = 1.5, hjust = -7.5), data = cutoff) +
  scale_x_discrete(limits = c("emptybox", "ctrl_dye_qe", "TU3", "TU4", "MS", "MS2"), labels = c("Empty box", "Dye+QE", "40 ug/ml", "20 ug/ml", "MS", "MS2")) +
  labs(y = "Sensor readings", x = "Samples") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
```

This will need more work to suss out.

### More expensive filters do not lead to an obvious improvement

We had different filters to test with: a cheap acrylic 510nm long-pass filter, and more expensive glass filters (515nm coloured glass long-pass, 495nm dichroic short-pass). In addition to the cost, the glass filters are also much harder to cut into smaller pieces for someone with little experience in glass cutting. It is possible to custom-order smaller pieces, but this comes at an (unknown) extra cost. The acrylic filter, on the other hand, can easily be cut into smaller pieces even by someone who is relatively inexperienced.
Generally speaking, the dichroic/glass combination results in much less light reaching the sensor (which is to be expected):

```{r echo=FALSE}
file <- "../data/2018-04-25_GelGreen_50bpladder_replica2.csv"
ds1 <- read.csv(file,
              header = TRUE,
              sep = ",",
              comment.char = "#")
file <- "../data/2018-04-26_GelGreen_QE_2_replica1.csv"
ds2 <- read.csv(file,
              header = TRUE,
              sep = ",",
              comment.char = "#")
file <- "../data/2018-04-26_GelGreen_QE_2_filters.csv"
ds3 <- read.csv(file,
              header = TRUE,
              sep = ",",
              comment.char = "#")
ds1$experiment <- c("510nm acrylic")  # ladder only, filter: 510nm acrylic
ds2$experiment <- c("QE, 510a")  # DNA extraction, filter: 510nm acrylic
ds3$experiment <- c("495nm dichroic+515nm glass")  # DNA extraction, filters: dichroic + glass long-pass
#ds <- rbind(ds1, ds2, ds3)
ds <- rbind(ds1, ds3)
ds_high <- ds %>% filter(gain == "HIGH", name != "ctrl_dye_qe", name != "MS", name != "MS2")
ds1_ctrl_wd_median <- ds_high %>% filter(name == "ctrl_dye_water", experiment == "510nm acrylic") %>% summarise(m = median(value))
ds2_ctrl_wd_median <- ds_high %>% filter(name == "ctrl_dye_water", experiment == "495nm dichroic+515nm glass") %>% summarise(m = median(value))
cutoff1 <- data.frame(yintercept=ds1_ctrl_wd_median$m, cutoff=factor(ds1_ctrl_wd_median$m))
cutoff2 <- data.frame(yintercept=ds2_ctrl_wd_median$m, cutoff=factor(ds2_ctrl_wd_median$m))
ds_high %>% 
  ggplot() + 
  geom_boxplot(mapping = aes(x = name, y = value, colour = experiment)) +
  geom_hline(aes(yintercept=yintercept), data=cutoff1, colour = "black", size = 0.2) +
#  geom_text(aes(0, yintercept, label = "Dye+Water 510nm", vjust = 1.5, hjust = -2), data = cutoff1) +
  geom_hline(aes(yintercept=yintercept), data=cutoff2, colour = "black", size = 0.2) +
#  geom_text(aes(0, yintercept, label = "Dye+Water Dichroic+glass", vjust = 1.5, hjust = -2), data = cutoff2) +
  labs(y = "Sensor readings", x = "Samples") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

```

However, this difference in light levels is not constant; there appears to be some correlation to the DNA concentration. The following is a graph of the differences between corresponding measurements for the two filter setups (510nm acrylic long-pass vs 495nm dichroic short-pass plus 515nm glass long-pass):

```{r echo=FALSE}
ds <- read.csv("/home/lisa/projects/biolab/hardware/fluorometer/aolw2018-capetown/data/2018-04-28_510nm_dichroicglass_diff.csv", header = TRUE, sep = ",", comment.char = "#")
ds %>%
  filter(gain == "HIGH") %>%
  ggplot() +
    geom_boxplot(mapping = aes(x = name, y = value)) +
    labs(y = "Delta", x = "Samples") +
    theme(axis.text.x = element_text(angle = 90, hjust = 1))
```

There are two possibilities here: 1) The dichroic filter takes away too much light that would otherwise lead to increased excitement of the fluorescent dye and thus more fluorescence. 2) The 515nm long-pass filter takes away too much of the fluorescent light. The reason for both may be either that the filters we have are not ideally matched to GelGreen, or that this is a more fundamental problem when working with dyes where the excitation and the emission wavelengths are very close together.
To resolve this, we should take measurements with more combinations of filters: 515nm glass only, and 510nm acrylic plus dichroic.

It is noteworthy that the lower detection limit did not improve with the more expensive glass filters.

### Testing with extracted DNA

We learned that our system detects something, although we obviously have no way of confidently stating that the DNA concentration we estimated from our data for these samples was in any way accurate. Nevertheless, there were two valuable results from this experiment:

1. The system does detect DNA in something other than a pure DNA sample, which the DNA ladder should be assumed to be. Before the workshop, the fluorometer had only been tested using DNA ladder, and it was entirely possible that a real-world extracted DNA sample would give no results at all, or totally nonsensical results.
2. We did see an increase in fluorescence when we adapted our DNA extraction protocol in a way that was designed to yield more DNA.

### Lens does not appear to be necessary

Since the measurements for the previous version v2 that did include a lens were taken using incorrect code, the measurements from the two versions are not directly comparable, so we cannot quantify the impact of our design change between v2 and v3. However, a good amount of light reached the sensor in our v3 design that did not include a lens. Only the concentrations of 20ug/ml and below even returned valid values for the maximum gain setting. This indicates that a lens is not necessary, as long as the sensor is placed very close to the sample.

### The v2 version using a fabbed cuvette could detect sligthly lower concentrations than the v3 version 

This has to be taken with a grain of salt since the sensor code of v2 returned invalid values for any gain setting other than MAX. However, for lower concentrations of DNA, the v2 code likely recorded the MAX gain setting, which are returned unaltered, so there is a good chance that we can compare the values from v2 and v3 at lower DNA concentrations.
It looks like the lower detection limit for the v2 version was around 10ug/ml, while that for v3 was 20ug/ml. By lower detection limit, we mean the highest concentration at which the sensor readings are very similar to the Dye+Water control, which means that we would be unable to distinguish this concentration of DNA from a water sample.
This merits further investigation: It is possible that this is a fluke in the data, or it is possible that our sensor/LED setup in v3 led to a real change, or it is possible that the shape and optical properties of the PCR tubes vs. the cuvette lead to this change.

## Future work

### Text marker dye as a cheap standard

We considered investigating text marker dye as a cheap standard. This was an idea that Ben Pfaffenhausen proposed. I'm not 100% convinced this will actually give good enough results since there are several variations in the system (preparation of dye stock and preparation of buffer for example) that you would not be able to capture with the text marker dye, but I like the idea and would like to see whether you could get some benefit out of it.

### Repeat the experiments we did at the workshop with proper buffer, and continue with that as well (with caveats)

We will make TE buffer and run through the same experiments again using that. This is necessary since all protocols we've found for SYBR Green I and PicoGreen use buffers, and also the paper [Nakayama et al 2016] showed somewhat convincingly that diluting with distilled water can lead to an underestimation of the DNA concentration in some types of samples. So at least we would need a good argument to keep using distilled water.
I would like to do measurements with distilled water with an appropriate amount of NaCl added, simply because this would be cheaper and easier to source than TE.

### Repeat the experiments with the two other dyes (Pico488 ~ PicoGreen and dsGreen ~ SYBR Green I)

Repeat the DNA ladder serial dilution as well as the DNA extraction measurements using Pico488 and dsGreen. There are protocols available for fluorometric DNA quantification with these two dyes, so we are going to follow them.

### Repeat the experiments with other filter combinations

Since the first experiment with different filter sets left some questions open, we should repeat the DNA ladder serial dilution as well as the DNA quantification measurements using different filter combinations and compare the results:

* 510nm acrylic long-pass plus 495nm dichroic short-pass
* 515nm colour glass long-pass only

### Repeat the experiments with different dye concentrations

So far, we only tested with a single dye concentration. There are no protocols for performing fluorometric DNA quantification with GelGreen, and so it is entirely unclear whether the concentration we chose is optimal. It is also unclear whether the dynamic range of GelGreen is sufficient to capture a broad range of DNA concentrations, or whether GelGreen has properties similar to that of Hoechst dye 33285, which is known to have a limited dynamic range so that it is standard practice to take two fluorometric measurements, each one using a different concentration of this dye.

### Characterize the different combinations of dyes and filters and sample vessels better

For each of the two sample vessels 0.2ml PCR tube and hand-made cuvette, perform the experiments in the following matrix:

| Dye \\ Filters | 510nm LP only | 515nm LP only | 495nm SP + 510nm LP | 495nm SP + 515nm LP |
| -------------- | ------------- | ------------- | ------------------- | ------------------- |
| GelGreen 1:99  |               |               |                     |                     |
| GelGreen 1:49  |               |               |                     |                     |
| GelGreen 1:199 |               |               |                     |                     |
| Pico488 (protocol)  |               |               |                     |                     |
| dsGreen (protocol)  |               |               |                     |                     |


For each of the combinations, determine the linear ranges of DNA concentrations, as well as the upper and lower detection limits.

### Migrate to the NodeMCU

Continue the work on migration to NodeMCU, making full use of the NodeMCU's features. Eventually, we'd like a device that just needs to connected to a power source and can be interacted with wirelessly.

### Single value output

Right now, each measurement records the sensor reading at each of the four gain settings. It would be better to fold this into one value, possibly based on the Lux calculation in Adafruit's TSL2591 library. This is a task for after doing all the experimental measurements outlined above, though.

### Get some solid data on the sample vessel question

Since the data we have suggest that the fabbed cuvette allows for detection of lower DNA concentrations, let's figure out whether this is an actual fact or just a fluke in the data. If the fabbed cuvette turns out to be better, it could be worth trying to improve on it, for example by casting the cuvettes from some kind of resin. The cast would be made in a CNC mill.
We should probably keep around both options, since using 0.2ml PCR tubes may be preferable to some people, depending on their requirements and resources.

### Comparison with a commercially available fluorometry system (e.g. Qubit)

This will mainly serve to better understand the performance and limitations of our system, and to enable us as well as users to decide whether the DIY fluorometer could be sufficient for their particular application.

### Make a version of the fluorometer from transparent acrylic for education purposes

Since it is such a simple measurement principle and such a simple device, it could be interesting to have a see-through version for education purposes and to illustrate how the device works.

### Idea to evaluate: Measuring absorbance

The question here is whether we would gain anything by adding measurement of absorbance. This could be done by shining light that does not excite the dye (e.g. red light) through the sample and measuring the amount of light that arrives at the sensor, then performing the same measurement with an empty chamber and an empty tube and comparing the three values. The motivation for this is that samples with a very high DNA and/or dye concentration will be more opaque than samples with a lower DNA concentration.
We arrived at this question mostly from experiments with text marker dye, where the effect is very pronounced. It is entirely unclear how much this affects measurements with DNA, though.

## What work would we want to add before considering publishing this in a journal?

Things I would like to see in such a paper:

* Is it feasible to use PCR tubes, or fabbed microliter cuvettes? What are the performance parameters of such a system (linear range? upper and lower detection limits?) This would be interesting because proper microliter cuvettes are expensive and not trivial to source.
* What is the performance of the different dyes with our system? One interesting aspect of this might be that one of the dyes we used (GelGreen) has, as far as I know, not yet shown up in a publication for the application of DNA quantification. What is the relationship between dye cost and performance? Also, the dsGreen dye we have is meant for gel staining. The qPCR version is much more expensive, but I think that using the cheaper gel staining version is probably not a problem when following the standard method of fluorescence quantification, which always includes measuring reference standards along with your actual sample.
* Comparison with a Qubit system
* Comparison of different filters, again with an eye towards cost/performance tradeoffs
* Make all measurements from now on with the same DNA standard, rather than mixing and matching different ones just because we still have some left. and we're starting to mix and match different ones, which is methodically not a super-clean thing to do...

## Conclusion

We built a v3 prototype of the OpenFluorometer that uses 0.2ml PCR tubes as sample vessels. The measurement data we obtained during the workshop suggests that these vessels may not be ideal for fluorometric DNA quantification, although they may be sufficient for some applications where low concentrations (below 20ug/ml) are not of interest to the user.
We tested different filter sets; our data so far suggest that using expensive glass filters may not be necessary and may in fact decrease performance. We also learned that incorporating a lens in the optical setup of our fluorometer may not be necessary as long as the sensor is placed as close as possible to the sample. We learned that using distilled water to dilute samples and dye may lead to underestimation of the DNA concentration in a sample, and thus TE or at least distilled water with added NaCl should be used instead.

We tested a different approach that uses only a smartphone, an LED and a photoresistor and found that it gave good results, comparable to that of our other version using a more expensive light sensor.
We defined a set of experiments that we want to perform going forward in an effort to develop the OpenFluorometer to a point where it can be used in real applications.

## References

[Nakayama et al 2016] Nakayama, Y., Yamaguchi, H., Einaga, N., & Esumi, M. (2016). Pitfalls of DNA Quantification Using DNA-Binding Fluorescent Dyes and Suggested Solutions. PLoS ONE, 11(3), e0150528. http://doi.org/10.1371/journal.pone.0150528
[Gallagher and Desjardins 2008] Gallagher, S. R. and Desjardins, P. R. (2008), Quantitation of DNA and RNA with Absorption and Fluorescence Spectroscopy. Current Protocols in Protein Science, 52: A.4K.1-A.4K.21. doi:10.1002/0471140864.psa04ks52

## Appendix A - Protocol: DNA extraction and measurement using Epicentre QuickExtract DNA extraction solution

This protocol was adapted from the manufacturer's protocol (http://www.epibio.com/docs/default-source/protocols/buccalamp-dna-extraction-kit-quickextract-dna-extraction-solution-1-0-catch-all-sample-collection-swabs.pdf?sfvrsn=6).
We adapted it slightly to compensate for the unavailability of a vortexer: Instead of vortexing, we vigorously agitated the sample by hand. We also used regular Q-tips instead of specialized buccal swabs. This might have affected the yield, and certainly led to contamination with DNA from other sources. However, the latter was not a concern for our purposes.

### Materials

* 2 Thermos containers
* QuickExtract
* 2.0ml reaction tube
* Q-tips
* Dye stock 1:99 GelGreen 10,000X
* 0.2ml PCR tube
* Micropipette 10-100ul
* Micropipette, 0.5-10ul
* Pipette tips, 10ul
* Pipette tips, 100ul

### Instructions

#### Step 1 - Prepare the water baths

1. Label the thermos containers, 65C and 98C
2. Heat water and adjust to 65C and 98C using a thermometer. Close the containers.

#### Step 2 - Label the reaction tubes

1. Label the 2.0ml reaction tube "QE" for QuickExtract
2. Label the 0.2ml PCR tube "MS" for measurement sample

#### Step 2 - Prepare the reaction tubes

1. Transfer 0.5ml of QuickExtract into the tube labeled "QE"

#### Step 3 - Take the sample

1. Thoroughly rinse out the subject’s mouth twice with water. We recommend that
subjects abstain from drinking coffee before tissue collection. Alternatively, instruct
subjects to gently brush the inside surface of both cheeks with a toothbrush
(without toothpaste) followed by a thorough rinsing of the mouth with water.
2. Collect tissue by rolling the Q-Tip firmly on the inside of
the cheek, approximately 20 times on each side, making certain to move the brush
over the entire cheek.
3. Place the swab end of the Q-tip into the tube labeled "QE" and rotate the brush a minimum of five times.
Press the brush against the side of the tube and rotate the brush while removing it
from the tube to ensure most of the liquid remains in the tube.
3.1 (optional, to improve yield) Repeat with three more Q-tips.
4. Screw the cap on the tube tightly and shake thoroughly for 10 seconds. Incubate the tube at 65°C for 1 minute.
5. Shake thoroughly for 15 seconds.
6. Transfer the tube to 98°C and incubate for 2 minutes.
8. Shake thoroughly for 15 seconds.

#### Step 4 - Prepare the sample for measurement

1. Transfer 40ul of liquid from the tube labeled "QE" to the tube labeled "MS"
2. Transfer 10ul of dye stock 1:99 to the tube labeled "MS"
3. Incubate the tube "MS" for 30 minutes at room temperature

#### Step 5 - Take the measurement

1. Measure Dye+Water control, Dye+QE control, TU1, TU3, TU4, MS and record the measurements

## Appendix B - Protocol: Preparing a serial dilution of text marker dye

### Materials

* 16 0.2ml PCR tubes
* Stabilo Boss text marker, yellow
* Micropipette 10-100ul
* Pipette tips, 100ul
* Bottled water

### Instructions

#### Step 1 - Labeling the tubes

Label 16 PCR tubes "S1" through "S16".

#### Step 2 - Preparing the text marker dye stock

1. Using the 10-100ul micropipette at 100ul, draw up text marker dye by sticking the pipette tip into the text marker tip. Draw up slowly.
2. Transfer the text marker dye into the tube labelled S1.
You may need to repeat this once or twice to get a total volume of 100ul of dye.

#### Step 3 - Preparing a two-fold serial dilution

1. Add 50ul of water to tubes S2 through S16.
2. Transfer 50ul of liquid from tube S1 to tube S2. Mix by pipetting.
3. Transfer 50ul of liquid from tube S2 to tube S3. Mix by pipetting.
4.-16. Repeat until you transfer into S16.
17. Remove 50ul of liquid from S16 and discard it.

## Appendix C - Protocol: Preparing a serial dilution of DNA ladder and GelGreen 

### Materials

* 12 0.2ml PCR tubes
* 100ul DNA ladder, starting concentration 200ug/ml
* DNA dye - GelGreen 10,000X in water
* Dark box (Can just be a cardboard box)
* Bottled water

### Instructions

#### Step 1 - Preparation of dye stock

Transfer 99ul of water into the tube labeled DS. Add 1ul of GelGreen 10,000X and mix by pipetting. Store tube in dark box when not used.

#### Step 2 - Labeling the tubes

Label 12 PCR tubes as follows:

| Label | Comment    |
| ----- | ---------- |
| TU1   | 160 ug/ml  |
| TU2   | 80 ug/ml   |
| TU3   | 40 ug/ml   |
| TU4   | 20 ug/ml   |
| TU5   | 10 ug/ml   |
| TU6   | 5 ug/ml    |
| TU7   | 2.5 ug/ml  |
| TU8   | 1.25 ug/ml |
| H20   | Control 1, water |
| Dye+H2O| Control 2, water + dye stock |
| Empty | Control 3, Empty tube |
| DS    | Dye stock |

#### Step 3 - Making the two-fold dilution series

1. Add 40ul of water to the tubes TU2 through TU8 and Dye+H2O
2. Add 80ul of DNA ladder to TU1
3. Transfer 40ul of liquid from TU1 to TU2. Mix by pipetting.
4. Transfer 40ul of liquid from TU2 to TU3. Mix by pipetting.
5. Transfer 40ul of liquid from TU3 to TU4. Mix by pipetting.
6. Transfer 40ul of liquid from TU4 to TU5. Mix by pipetting.
7. Transfer 40ul of liquid from TU5 to TU6. Mix by pipetting.
8. Transfer 40ul of liquid from TU6 to TU7. Mix by pipetting.
9. Transfer 40ul of liquid from TU7 to TU8. Mix by pipetting.
10. Discard 40ul of liquid from TU8.

#### Step 4: Adding the dye stock

Add 10ul of the 1:99 dye stock to the tubes TU1 through TU8 and Dye+H2O.

Place all tubes in the dark box after adding the dye to prevent unnecessary exposure to light and possible photobleaching.

#### Step 5: Preparing the water control

Add 50ul of water to the tube H2O.
